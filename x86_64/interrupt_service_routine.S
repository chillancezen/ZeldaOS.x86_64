// Copyright (c) 2018 Jie Zheng

.extern interrupt_handler


.section .text
.code64

per_vector_entry:
    pushq %rax
    pushq %rbx
    pushq %rcx
    pushq %rdx
    pushq %rsi
    pushq %rdi
    pushq %rbp
    pushq %r15
    pushq %r14
    pushq %r13
    pushq %r12
    pushq %r11
    pushq %r10
    pushq %r9
    pushq %r8
    movq %gs, %rax
    pushq %rax
    movq %fs, %rax
    pushq %rax
    movq %es, %rax
    pushq %rax
    movq %ds, %rax
    pushq %rax
    // the whole cpu_state has been saved, next we call the unique interrupt
    // service entry which is written in C
    movq %rsp, %rdi
    call interrupt_handler
    movq %rax, %rsp
    // restore the cpu state
    popq %rax
    movq %rax, %ds
    popq %rax
    movq %rax, %es
    popq %rax
    movq %rax, %fs
    popq %rax
    movq %rax, %gs
    popq %r8
    popq %r9
    popq %r10
    popq %r11
    popq %r12
    popq %r13
    popq %r14
    popq %r15
    popq %rbp
    popq %rdi
    popq %rsi
    popq %rdx
    popq %rcx
    popq %rbx
    popq %rax
    //pop two extra qword which is vector and error_code
    addq $16, %rsp
    iretq

.macro DEF_INT_ENTRY_WITH_ERRORCODE vectoor
.global int\vectoor
.align 8
int\vectoor:
    cli
    pushq $\vectoor
    jmp per_vector_entry
.endm

.macro DEF_INT_ENTRY_WITHOUT_ERRORCODE vectoor
.global int\vectoor
.align 8
int\vectoor:
    cli
    pushq $0
    pushq $\vectoor
    jmp per_vector_entry
.endm

DEF_INT_ENTRY_WITHOUT_ERRORCODE 0
DEF_INT_ENTRY_WITHOUT_ERRORCODE 1
DEF_INT_ENTRY_WITHOUT_ERRORCODE 2
DEF_INT_ENTRY_WITHOUT_ERRORCODE 3
DEF_INT_ENTRY_WITHOUT_ERRORCODE 4
DEF_INT_ENTRY_WITHOUT_ERRORCODE 5
DEF_INT_ENTRY_WITHOUT_ERRORCODE 6
DEF_INT_ENTRY_WITHOUT_ERRORCODE 7
DEF_INT_ENTRY_WITH_ERRORCODE 8
DEF_INT_ENTRY_WITHOUT_ERRORCODE 9
DEF_INT_ENTRY_WITH_ERRORCODE 10
DEF_INT_ENTRY_WITH_ERRORCODE 11
DEF_INT_ENTRY_WITH_ERRORCODE 12
DEF_INT_ENTRY_WITH_ERRORCODE 13
DEF_INT_ENTRY_WITH_ERRORCODE 14
DEF_INT_ENTRY_WITHOUT_ERRORCODE 15
DEF_INT_ENTRY_WITHOUT_ERRORCODE 16
DEF_INT_ENTRY_WITHOUT_ERRORCODE 17
DEF_INT_ENTRY_WITHOUT_ERRORCODE 18
DEF_INT_ENTRY_WITHOUT_ERRORCODE 19
DEF_INT_ENTRY_WITHOUT_ERRORCODE 20
DEF_INT_ENTRY_WITHOUT_ERRORCODE 21
DEF_INT_ENTRY_WITHOUT_ERRORCODE 22
DEF_INT_ENTRY_WITHOUT_ERRORCODE 23
DEF_INT_ENTRY_WITHOUT_ERRORCODE 24
DEF_INT_ENTRY_WITHOUT_ERRORCODE 25
DEF_INT_ENTRY_WITHOUT_ERRORCODE 26
DEF_INT_ENTRY_WITHOUT_ERRORCODE 27
DEF_INT_ENTRY_WITHOUT_ERRORCODE 28
DEF_INT_ENTRY_WITHOUT_ERRORCODE 29
DEF_INT_ENTRY_WITHOUT_ERRORCODE 30
DEF_INT_ENTRY_WITHOUT_ERRORCODE 31
DEF_INT_ENTRY_WITHOUT_ERRORCODE 32
DEF_INT_ENTRY_WITHOUT_ERRORCODE 33
DEF_INT_ENTRY_WITHOUT_ERRORCODE 34
DEF_INT_ENTRY_WITHOUT_ERRORCODE 35
DEF_INT_ENTRY_WITHOUT_ERRORCODE 36
DEF_INT_ENTRY_WITHOUT_ERRORCODE 37
DEF_INT_ENTRY_WITHOUT_ERRORCODE 38
DEF_INT_ENTRY_WITHOUT_ERRORCODE 39
DEF_INT_ENTRY_WITHOUT_ERRORCODE 40
DEF_INT_ENTRY_WITHOUT_ERRORCODE 41
DEF_INT_ENTRY_WITHOUT_ERRORCODE 42
DEF_INT_ENTRY_WITHOUT_ERRORCODE 43
DEF_INT_ENTRY_WITHOUT_ERRORCODE 44
DEF_INT_ENTRY_WITHOUT_ERRORCODE 45
DEF_INT_ENTRY_WITHOUT_ERRORCODE 46
DEF_INT_ENTRY_WITHOUT_ERRORCODE 47
DEF_INT_ENTRY_WITHOUT_ERRORCODE 48
DEF_INT_ENTRY_WITHOUT_ERRORCODE 49
DEF_INT_ENTRY_WITHOUT_ERRORCODE 50
DEF_INT_ENTRY_WITHOUT_ERRORCODE 51
DEF_INT_ENTRY_WITHOUT_ERRORCODE 52
DEF_INT_ENTRY_WITHOUT_ERRORCODE 53
DEF_INT_ENTRY_WITHOUT_ERRORCODE 54
DEF_INT_ENTRY_WITHOUT_ERRORCODE 55
DEF_INT_ENTRY_WITHOUT_ERRORCODE 56
DEF_INT_ENTRY_WITHOUT_ERRORCODE 57
DEF_INT_ENTRY_WITHOUT_ERRORCODE 58
DEF_INT_ENTRY_WITHOUT_ERRORCODE 59
DEF_INT_ENTRY_WITHOUT_ERRORCODE 60
DEF_INT_ENTRY_WITHOUT_ERRORCODE 61
DEF_INT_ENTRY_WITHOUT_ERRORCODE 62
DEF_INT_ENTRY_WITHOUT_ERRORCODE 63
DEF_INT_ENTRY_WITHOUT_ERRORCODE 64
DEF_INT_ENTRY_WITHOUT_ERRORCODE 65
DEF_INT_ENTRY_WITHOUT_ERRORCODE 66
DEF_INT_ENTRY_WITHOUT_ERRORCODE 67
DEF_INT_ENTRY_WITHOUT_ERRORCODE 68
DEF_INT_ENTRY_WITHOUT_ERRORCODE 69
DEF_INT_ENTRY_WITHOUT_ERRORCODE 70
DEF_INT_ENTRY_WITHOUT_ERRORCODE 71
DEF_INT_ENTRY_WITHOUT_ERRORCODE 72
DEF_INT_ENTRY_WITHOUT_ERRORCODE 73
DEF_INT_ENTRY_WITHOUT_ERRORCODE 74
DEF_INT_ENTRY_WITHOUT_ERRORCODE 75
DEF_INT_ENTRY_WITHOUT_ERRORCODE 76
DEF_INT_ENTRY_WITHOUT_ERRORCODE 77
DEF_INT_ENTRY_WITHOUT_ERRORCODE 78
DEF_INT_ENTRY_WITHOUT_ERRORCODE 79
DEF_INT_ENTRY_WITHOUT_ERRORCODE 80
DEF_INT_ENTRY_WITHOUT_ERRORCODE 81
DEF_INT_ENTRY_WITHOUT_ERRORCODE 82
DEF_INT_ENTRY_WITHOUT_ERRORCODE 83
DEF_INT_ENTRY_WITHOUT_ERRORCODE 84
DEF_INT_ENTRY_WITHOUT_ERRORCODE 85
DEF_INT_ENTRY_WITHOUT_ERRORCODE 86
DEF_INT_ENTRY_WITHOUT_ERRORCODE 87
DEF_INT_ENTRY_WITHOUT_ERRORCODE 88
DEF_INT_ENTRY_WITHOUT_ERRORCODE 89
DEF_INT_ENTRY_WITHOUT_ERRORCODE 90
DEF_INT_ENTRY_WITHOUT_ERRORCODE 91
DEF_INT_ENTRY_WITHOUT_ERRORCODE 92
DEF_INT_ENTRY_WITHOUT_ERRORCODE 93
DEF_INT_ENTRY_WITHOUT_ERRORCODE 94
DEF_INT_ENTRY_WITHOUT_ERRORCODE 95
DEF_INT_ENTRY_WITHOUT_ERRORCODE 96
DEF_INT_ENTRY_WITHOUT_ERRORCODE 97
DEF_INT_ENTRY_WITHOUT_ERRORCODE 98
DEF_INT_ENTRY_WITHOUT_ERRORCODE 99
DEF_INT_ENTRY_WITHOUT_ERRORCODE 100
DEF_INT_ENTRY_WITHOUT_ERRORCODE 101
DEF_INT_ENTRY_WITHOUT_ERRORCODE 102
DEF_INT_ENTRY_WITHOUT_ERRORCODE 103
DEF_INT_ENTRY_WITHOUT_ERRORCODE 104
DEF_INT_ENTRY_WITHOUT_ERRORCODE 105
DEF_INT_ENTRY_WITHOUT_ERRORCODE 106
DEF_INT_ENTRY_WITHOUT_ERRORCODE 107
DEF_INT_ENTRY_WITHOUT_ERRORCODE 108
DEF_INT_ENTRY_WITHOUT_ERRORCODE 109
DEF_INT_ENTRY_WITHOUT_ERRORCODE 110
DEF_INT_ENTRY_WITHOUT_ERRORCODE 111
DEF_INT_ENTRY_WITHOUT_ERRORCODE 112
DEF_INT_ENTRY_WITHOUT_ERRORCODE 113
DEF_INT_ENTRY_WITHOUT_ERRORCODE 114
DEF_INT_ENTRY_WITHOUT_ERRORCODE 115
DEF_INT_ENTRY_WITHOUT_ERRORCODE 116
DEF_INT_ENTRY_WITHOUT_ERRORCODE 117
DEF_INT_ENTRY_WITHOUT_ERRORCODE 118
DEF_INT_ENTRY_WITHOUT_ERRORCODE 119
DEF_INT_ENTRY_WITHOUT_ERRORCODE 120
DEF_INT_ENTRY_WITHOUT_ERRORCODE 121
DEF_INT_ENTRY_WITHOUT_ERRORCODE 122
DEF_INT_ENTRY_WITHOUT_ERRORCODE 123
DEF_INT_ENTRY_WITHOUT_ERRORCODE 124
DEF_INT_ENTRY_WITHOUT_ERRORCODE 125
DEF_INT_ENTRY_WITHOUT_ERRORCODE 126
DEF_INT_ENTRY_WITHOUT_ERRORCODE 127
DEF_INT_ENTRY_WITHOUT_ERRORCODE 128
DEF_INT_ENTRY_WITHOUT_ERRORCODE 129
DEF_INT_ENTRY_WITHOUT_ERRORCODE 130
DEF_INT_ENTRY_WITHOUT_ERRORCODE 131
DEF_INT_ENTRY_WITHOUT_ERRORCODE 132
DEF_INT_ENTRY_WITHOUT_ERRORCODE 133
DEF_INT_ENTRY_WITHOUT_ERRORCODE 134
DEF_INT_ENTRY_WITHOUT_ERRORCODE 135
DEF_INT_ENTRY_WITHOUT_ERRORCODE 136
DEF_INT_ENTRY_WITHOUT_ERRORCODE 137
DEF_INT_ENTRY_WITHOUT_ERRORCODE 138
DEF_INT_ENTRY_WITHOUT_ERRORCODE 139
DEF_INT_ENTRY_WITHOUT_ERRORCODE 140
DEF_INT_ENTRY_WITHOUT_ERRORCODE 141
DEF_INT_ENTRY_WITHOUT_ERRORCODE 142
DEF_INT_ENTRY_WITHOUT_ERRORCODE 143
DEF_INT_ENTRY_WITHOUT_ERRORCODE 144
DEF_INT_ENTRY_WITHOUT_ERRORCODE 145
DEF_INT_ENTRY_WITHOUT_ERRORCODE 146
DEF_INT_ENTRY_WITHOUT_ERRORCODE 147
DEF_INT_ENTRY_WITHOUT_ERRORCODE 148
DEF_INT_ENTRY_WITHOUT_ERRORCODE 149
DEF_INT_ENTRY_WITHOUT_ERRORCODE 150
DEF_INT_ENTRY_WITHOUT_ERRORCODE 151
DEF_INT_ENTRY_WITHOUT_ERRORCODE 152
DEF_INT_ENTRY_WITHOUT_ERRORCODE 153
DEF_INT_ENTRY_WITHOUT_ERRORCODE 154
DEF_INT_ENTRY_WITHOUT_ERRORCODE 155
DEF_INT_ENTRY_WITHOUT_ERRORCODE 156
DEF_INT_ENTRY_WITHOUT_ERRORCODE 157
DEF_INT_ENTRY_WITHOUT_ERRORCODE 158
DEF_INT_ENTRY_WITHOUT_ERRORCODE 159
DEF_INT_ENTRY_WITHOUT_ERRORCODE 160
DEF_INT_ENTRY_WITHOUT_ERRORCODE 161
DEF_INT_ENTRY_WITHOUT_ERRORCODE 162
DEF_INT_ENTRY_WITHOUT_ERRORCODE 163
DEF_INT_ENTRY_WITHOUT_ERRORCODE 164
DEF_INT_ENTRY_WITHOUT_ERRORCODE 165
DEF_INT_ENTRY_WITHOUT_ERRORCODE 166
DEF_INT_ENTRY_WITHOUT_ERRORCODE 167
DEF_INT_ENTRY_WITHOUT_ERRORCODE 168
DEF_INT_ENTRY_WITHOUT_ERRORCODE 169
DEF_INT_ENTRY_WITHOUT_ERRORCODE 170
DEF_INT_ENTRY_WITHOUT_ERRORCODE 171
DEF_INT_ENTRY_WITHOUT_ERRORCODE 172
DEF_INT_ENTRY_WITHOUT_ERRORCODE 173
DEF_INT_ENTRY_WITHOUT_ERRORCODE 174
DEF_INT_ENTRY_WITHOUT_ERRORCODE 175
DEF_INT_ENTRY_WITHOUT_ERRORCODE 176
DEF_INT_ENTRY_WITHOUT_ERRORCODE 177
DEF_INT_ENTRY_WITHOUT_ERRORCODE 178
DEF_INT_ENTRY_WITHOUT_ERRORCODE 179
DEF_INT_ENTRY_WITHOUT_ERRORCODE 180
DEF_INT_ENTRY_WITHOUT_ERRORCODE 181
DEF_INT_ENTRY_WITHOUT_ERRORCODE 182
DEF_INT_ENTRY_WITHOUT_ERRORCODE 183
DEF_INT_ENTRY_WITHOUT_ERRORCODE 184
DEF_INT_ENTRY_WITHOUT_ERRORCODE 185
DEF_INT_ENTRY_WITHOUT_ERRORCODE 186
DEF_INT_ENTRY_WITHOUT_ERRORCODE 187
DEF_INT_ENTRY_WITHOUT_ERRORCODE 188
DEF_INT_ENTRY_WITHOUT_ERRORCODE 189
DEF_INT_ENTRY_WITHOUT_ERRORCODE 190
DEF_INT_ENTRY_WITHOUT_ERRORCODE 191
DEF_INT_ENTRY_WITHOUT_ERRORCODE 192
DEF_INT_ENTRY_WITHOUT_ERRORCODE 193
DEF_INT_ENTRY_WITHOUT_ERRORCODE 194
DEF_INT_ENTRY_WITHOUT_ERRORCODE 195
DEF_INT_ENTRY_WITHOUT_ERRORCODE 196
DEF_INT_ENTRY_WITHOUT_ERRORCODE 197
DEF_INT_ENTRY_WITHOUT_ERRORCODE 198
DEF_INT_ENTRY_WITHOUT_ERRORCODE 199
DEF_INT_ENTRY_WITHOUT_ERRORCODE 200
DEF_INT_ENTRY_WITHOUT_ERRORCODE 201
DEF_INT_ENTRY_WITHOUT_ERRORCODE 202
DEF_INT_ENTRY_WITHOUT_ERRORCODE 203
DEF_INT_ENTRY_WITHOUT_ERRORCODE 204
DEF_INT_ENTRY_WITHOUT_ERRORCODE 205
DEF_INT_ENTRY_WITHOUT_ERRORCODE 206
DEF_INT_ENTRY_WITHOUT_ERRORCODE 207
DEF_INT_ENTRY_WITHOUT_ERRORCODE 208
DEF_INT_ENTRY_WITHOUT_ERRORCODE 209
DEF_INT_ENTRY_WITHOUT_ERRORCODE 210
DEF_INT_ENTRY_WITHOUT_ERRORCODE 211
DEF_INT_ENTRY_WITHOUT_ERRORCODE 212
DEF_INT_ENTRY_WITHOUT_ERRORCODE 213
DEF_INT_ENTRY_WITHOUT_ERRORCODE 214
DEF_INT_ENTRY_WITHOUT_ERRORCODE 215
DEF_INT_ENTRY_WITHOUT_ERRORCODE 216
DEF_INT_ENTRY_WITHOUT_ERRORCODE 217
DEF_INT_ENTRY_WITHOUT_ERRORCODE 218
DEF_INT_ENTRY_WITHOUT_ERRORCODE 219
DEF_INT_ENTRY_WITHOUT_ERRORCODE 220
DEF_INT_ENTRY_WITHOUT_ERRORCODE 221
DEF_INT_ENTRY_WITHOUT_ERRORCODE 222
DEF_INT_ENTRY_WITHOUT_ERRORCODE 223
DEF_INT_ENTRY_WITHOUT_ERRORCODE 224
DEF_INT_ENTRY_WITHOUT_ERRORCODE 225
DEF_INT_ENTRY_WITHOUT_ERRORCODE 226
DEF_INT_ENTRY_WITHOUT_ERRORCODE 227
DEF_INT_ENTRY_WITHOUT_ERRORCODE 228
DEF_INT_ENTRY_WITHOUT_ERRORCODE 229
DEF_INT_ENTRY_WITHOUT_ERRORCODE 230
DEF_INT_ENTRY_WITHOUT_ERRORCODE 231
DEF_INT_ENTRY_WITHOUT_ERRORCODE 232
DEF_INT_ENTRY_WITHOUT_ERRORCODE 233
DEF_INT_ENTRY_WITHOUT_ERRORCODE 234
DEF_INT_ENTRY_WITHOUT_ERRORCODE 235
DEF_INT_ENTRY_WITHOUT_ERRORCODE 236
DEF_INT_ENTRY_WITHOUT_ERRORCODE 237
DEF_INT_ENTRY_WITHOUT_ERRORCODE 238
DEF_INT_ENTRY_WITHOUT_ERRORCODE 239
DEF_INT_ENTRY_WITHOUT_ERRORCODE 240
DEF_INT_ENTRY_WITHOUT_ERRORCODE 241
DEF_INT_ENTRY_WITHOUT_ERRORCODE 242
DEF_INT_ENTRY_WITHOUT_ERRORCODE 243
DEF_INT_ENTRY_WITHOUT_ERRORCODE 244
DEF_INT_ENTRY_WITHOUT_ERRORCODE 245
DEF_INT_ENTRY_WITHOUT_ERRORCODE 246
DEF_INT_ENTRY_WITHOUT_ERRORCODE 247
DEF_INT_ENTRY_WITHOUT_ERRORCODE 248
DEF_INT_ENTRY_WITHOUT_ERRORCODE 249
DEF_INT_ENTRY_WITHOUT_ERRORCODE 250
DEF_INT_ENTRY_WITHOUT_ERRORCODE 251
DEF_INT_ENTRY_WITHOUT_ERRORCODE 252
DEF_INT_ENTRY_WITHOUT_ERRORCODE 253
DEF_INT_ENTRY_WITHOUT_ERRORCODE 254
DEF_INT_ENTRY_WITHOUT_ERRORCODE 255
